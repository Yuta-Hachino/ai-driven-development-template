# Enterprise Security Configuration
# Zero Trust Architecture and Multi-layer Defense

# Encryption settings
encryption:
  algorithm: AES-256-GCM
  key_rotation: 30  # days
  key_management:
    provider: google-kms
    key_ring: autonomous-dev-keyring
    location: global
  data_at_rest:
    enabled: true
    algorithm: AES-256-GCM
  data_in_transit:
    enabled: true
    min_tls_version: "1.3"
    cipher_suites:
      - TLS_AES_256_GCM_SHA384
      - TLS_CHACHA20_POLY1305_SHA256

# Authentication and Authorization
authentication:
  method: oauth2
  provider: google
  mfa:
    enabled: true
    required: true
    methods:
      - totp
      - security_key
  session:
    timeout: 3600  # seconds (1 hour)
    max_sessions_per_user: 3
    absolute_timeout: 28800  # seconds (8 hours)

authorization:
  model: rbac
  enforce_mfa_for_sensitive_operations: true

# Role-Based Access Control (RBAC)
rbac:
  roles:
    developer:
      permissions:
        - read:code
        - write:code
        - create:branch
        - create:pr
        - run:tests
      resources:
        - code
        - config
        - logs

    approver:
      permissions:
        - read:code
        - read:pr
        - approve:pr
        - reject:pr
        - merge:code
      resources:
        - pull_requests
        - deployments
        - reviews

    security_auditor:
      permissions:
        - read:*
        - scan:vulnerabilities
        - audit:logs
        - view:secrets_metadata
      resources:
        - "*"

    admin:
      permissions:
        - "*"
      resources:
        - "*"

  service_accounts:
    agent_service:
      permissions:
        - read:code
        - write:code
        - execute:tools
      max_token_lifetime: 3600

# Secret Management
secrets:
  provider: google-secret-manager
  project_id: ${GCP_PROJECT_ID}
  automatic_rotation: true
  rotation_schedule: "0 0 * * 0"  # Weekly on Sunday
  allowed_secret_types:
    - api_key
    - database_password
    - encryption_key
    - oauth_client_secret

# Container Security (gVisor)
container:
  runtime: gvisor
  sandbox: true
  runtime_class: gvisor
  security_context:
    run_as_non_root: true
    run_as_user: 1000
    run_as_group: 1000
    read_only_root_filesystem: true
    allow_privilege_escalation: false
    capabilities:
      drop:
        - ALL
  resource_limits:
    enforce: true

# Network Security
network:
  zero_trust: true
  vpc:
    name: autonomous-dev-vpc
    auto_create_subnets: false
    private_google_access: true

  firewall:
    default_action: deny
    allow_internal: true
    internal_ranges:
      - 10.0.0.0/8

  network_policies:
    enabled: true
    default_deny_ingress: true
    default_deny_egress: true

  tls:
    enforce: true
    min_version: "1.3"
    mutual_tls: true

# Audit and Compliance
audit:
  enabled: true
  log_all_access: true
  log_retention: 2555  # days (7 years)
  tamper_proof: true
  hash_chain: true

  events_to_log:
    - authentication
    - authorization
    - data_access
    - data_modification
    - configuration_changes
    - security_events
    - admin_actions

  compliance_frameworks:
    - GDPR
    - SOX
    - HIPAA
    - PCI-DSS

# Data Classification and Governance
data_classification:
  public:
    encryption: optional
    access: unrestricted
    retention_days: 365

  internal:
    encryption: required
    access: authenticated_users
    retention_days: 1095

  confidential:
    encryption: required
    access: authorized_roles_only
    retention_days: 1825
    audit: all_access

  restricted:
    encryption: required_with_hsm
    access: need_to_know_basis
    retention_days: 2555
    audit: real_time_monitoring
    mfa_required: true

# Vulnerability Scanning
vulnerability_scanning:
  enabled: true
  schedule: "0 */6 * * *"  # Every 6 hours
  scanners:
    - name: trivy
      targets:
        - container_images
        - filesystems
      severity_threshold: HIGH

    - name: sonarqube
      targets:
        - source_code
      quality_gate: passed

    - name: snyk
      targets:
        - dependencies
        - container_images
      severity_threshold: HIGH

    - name: owasp_zap
      targets:
        - web_applications
      scan_type: active

  auto_remediation:
    enabled: true
    max_severity: MEDIUM
    require_approval_for:
      - HIGH
      - CRITICAL

# Incident Response
incident_response:
  enabled: true
  auto_response: true

  severity_levels:
    critical:
      response_time: 15  # minutes
      actions:
        - isolate_affected_systems
        - preserve_evidence
        - notify_security_team
        - apply_emergency_patches

    high:
      response_time: 60  # minutes
      actions:
        - automated_containment
        - log_and_alert
        - notify_on_call_engineer

    medium:
      response_time: 240  # minutes
      actions:
        - log_and_alert
        - create_incident_ticket

    low:
      response_time: 1440  # minutes (24 hours)
      actions:
        - log_event

# Security Testing
security_testing:
  static_analysis:
    enabled: true
    on_commit: true
    tools:
      - sonarqube
      - checkmarx

  dynamic_analysis:
    enabled: true
    schedule: weekly
    tools:
      - owasp_zap
      - burp_suite

  penetration_testing:
    automated:
      enabled: true
      schedule: weekly
    manual:
      enabled: true
      schedule: quarterly

  chaos_engineering:
    enabled: true
    schedule: daily
    targets:
      - non_production

# Backup and Disaster Recovery
backup:
  enabled: true
  encryption: required

  schedule:
    full: weekly
    incremental: daily
    snapshot: hourly

  retention:
    full: 90  # days
    incremental: 30  # days
    snapshot: 7  # days

  locations:
    - region: us-central1
      type: primary
    - region: us-east1
      type: secondary
    - region: europe-west1
      type: tertiary

  verification:
    enabled: true
    schedule: weekly

disaster_recovery:
  rpo: 3600  # seconds (1 hour)
  rto: 14400  # seconds (4 hours)

  procedures:
    - validate_backup_integrity
    - provision_infrastructure
    - restore_data
    - verify_services
    - switch_traffic

# Security Monitoring
monitoring:
  enabled: true
  real_time: true

  metrics:
    - failed_authentication_attempts
    - unauthorized_access_attempts
    - anomalous_behavior
    - security_scan_results
    - vulnerability_count

  anomaly_detection:
    enabled: true
    ml_based: true
    sensitivity: high

  alerting:
    channels:
      - email
      - slack
      - pagerduty

    conditions:
      - type: failed_logins
        threshold: 5
        window: 300  # seconds
      - type: unauthorized_access
        threshold: 1
        immediate: true
      - type: critical_vulnerability
        threshold: 1
        immediate: true
